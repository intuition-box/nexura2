<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Wallet Injector</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
    <script src="/wallet-injector.js"></script>
    <style>body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px}button{padding:8px 12px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}input{padding:8px;border:1px solid #ccc;border-radius:6px;width:100%}</style>
  </head>
  <body>
    <h2>Wallet Injector</h2>
    <p>Enter a private key to inject a window.ethereum provider for local testing.</p>
    <label>Private key</label>
    <input id="pk" placeholder="0x..." />
    <div style="height:12px"></div>
    <button id="inject">Inject Wallet</button>
    <button id="clear">Clear Injection</button>
    <pre id="out" style="margin-top:12px;color:#111"></pre>
    <script>
      const out = document.getElementById('out');
      function log(msg){ try{ out.textContent += msg + '\n'; }catch{} }
      function createProvider(privateKey){
        const wallet = new ethers.Wallet(privateKey);
        const address = wallet.address;
        const provider = {
          isMetaMask: true,
          selectedAddress: address,
          request: async function(payload){
            const method = String(payload.method || '');
            if(method === 'eth_requestAccounts'){
              return [address];
            }
            if(method === 'eth_accounts'){
              return [address];
            }
            if(method === 'personal_sign' || method === 'eth_sign'){
              const params = payload.params || [];
              let message = params[0];
              if(method === 'personal_sign' && params.length >= 2){ message = params[0]; }
              if(typeof message !== 'string') message = String(message);
              const sig = await wallet.signMessage(message);
              return sig;
            }
            if(method === 'wallet_switchEthereumChain'){
              return null;
            }
            throw new Error('unhandled method ' + method);
          }
        };
        return { provider, address };
      }
      document.getElementById('inject').addEventListener('click', ()=>{
        const pk = (document.getElementById('pk').value || '').trim();
        if(!pk){ log('private key missing'); return; }
        try{
          const { provider, address } = createProvider(pk);
          window.ethereum = provider;
          window.__injected_injectedAddress = address;
          log('injected address ' + address);
        }catch(e){ log('injection failed: ' + String(e)); }
      });
      document.getElementById('clear').addEventListener('click', ()=>{
        try{ delete window.ethereum; delete window.__injected_injectedAddress; log('cleared injection'); }catch(e){ log('clear failed ' + String(e)); }
      });
    </script>
  </body>
</html>
